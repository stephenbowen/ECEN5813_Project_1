
include sources.mk

#platform dependent paramters
ifeq ($(PLATFORM), HOST)
  CPU = cortex-m4
	CC = gcc
	CFLAGS   = -g -Wall -Werror -std=c99 -O0 -DVERBOSE
	CPPFLAGS = -DHOST
  INCLUDES = -I./../include/common

else ifeq ($(PLATFORM), BBB)
  CPU = cortex-m4
  CC = arm-linux-gnueabihf-gcc
	CFLAGS   = -g -Wall -Werror -std=c99 -O0
	CPPFLAGS = -DBBB
	INCLUDES = -I./../include/common \
             -I./../include/CMSIS

else ifeq ($(PLATFORM), KL25Z)
  CPU = cortex-m0plus
  CC = arm-none-eabi-gcc
	CFLAGS   =--specs=nosys.specs -g -Wall -Werror -std=c99 -O0 \
             -march=armv6-m -mthumb
	CPPFLAGS = -DKL25Z
	INCLUDES = -I./../include/common \
             -I./../include/CMSIS \
             -I./../include/kl25z
  LDFLAGS = 

else
	CC = gcc
  INCLUDES = -I./../include/common
	CFLAGS   = -g -Wall -Werror -std=c99 -O0 -DVERBOSE
endif

TARGET_ELF = project1.elf
TARGET_I = obj.o

#Autogenerated Dependencies
DEPDIR := .d
$(shell mkdir -p $(DEPDIR) >/dev/null)
DEPFLAGS = -MT -$@ -MMD -MP -MF $(DEPDIR)/$*.d

IDIR := .i
$(shell mkdir -p $(IDIR) >/dev/null)
IFLAGS = -MT -$@ -MMD -MP -MF $(IDIR)/$*.i

#Objects
OBJS = main.o project1.o memory.o conversion.o debug.o data.o endian.o

#Targets
.PHONY: clean
clean:
	rm -f *.o *.i *.asm *.elf
	rm -r .d

.PHONY: build
build: $(TARGET_ELF)
$(TARGET_ELF): $(OBJS)
	$(CC) $(CFLAGS) $(CPPFLAGS) $(INCLUDES) $(LDFLAGS) $(SPECS) -o $@ $^

.PHONY: compile-all
compile-all: $(OBJS)
$(OBJS): $(SRCS)
	$(CC)  $(CFLAGS) $(CPPFLAGS) $(INCLUDES) $(LDFLAGS) $(SPECS) $(DEPFLAGS) -c $@ $^

main.i: main.c
	gcc -E $(INCLUDES) main.c

memory.o: memory.c
	$(CC) $(CFLAGS) $(CPPFLAGS) $(INCLUDES) $(LDFLAGS) $(DEPFLAGS) -c -o $@ $<

conversion.o: conversion.c
	$(CC) $(CFLAGS) $(CPPFLAGS) $(INCLUDES) $(LDFLAGS) $(DEPFLAGS) -c -o $@ $<

debug.o: debug.c
	$(CC) $(CFLAGS) $(CPPFLAGS) $(INCLUDES) $(LDFLAGS) $(DEPFLAGS) -c -o $@ $<

data.o: data.c
	$(CC) $(CFLAGS) $(CPPFLAGS) $(INCLUDES) $(LDFLAGS) $(DEPFLAGS) -c -o $@ $<

endian.o: endian.c
	$(CC) $(CFLAGS) $(CPPFLAGS) $(INCLUDES) $(LDFLAGS) $(DEPFLAGS) -c -o $@ $<

project1.o: project1.c
	$(CC) $(CFLAGS) $(CPPFLAGS) $(INCLUDES) $(LDFLAGS) $(DEPFLAGS) -c -o $@ $<

main.o: main.c
	$(CC) $(CFLAGS) $(CPPFLAGS) $(INCLUDES) $(LDFLAGS) $(DEPFLAGS) -c -o $@ $<


  
